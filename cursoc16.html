<HTML>
<HEAD>
<!-- InstanceBeginEditable name="doctitle" -->
<TITLE>Curso de C - Asignación dinámica de memoria</TITLE>
<!-- InstanceEndEditable --> 
<meta name="description" content="Curso de C - Asignación dinámica de memoria">
<meta name="keywords" content="Programación, Curso de C, C, malloc, free, memoria dinámica">
<META NAME="GENERATOR" CONTENT="Arachnophilia 3.5">
<META NAME="FORMATTER" CONTENT="Arachnophilia 3.5">
<meta name="author" content="Gorka Urrutia">
<meta name="DC.Creator" content="Gorka Urrutia">
<META name="robots" content="noindex, nofollow">
<style type="text/css">
<!--
    body {
        font-family: Verdana, Arial, sans-serif;
        font-size: 12px;
        background: white;
        color: #333;
        line-height: 1.6;
        margin: 20px;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
    }
    
    h1 {
        font-family: Verdana, Arial, sans-serif;
        font-size: 24pt;
        font-weight: bold;
        color: #006600;
        text-align: center;
        margin-bottom: 20px;
    }
    
    h2 {
        font-family: Verdana, Arial, sans-serif;
        font-size: 18pt;
        font-weight: bold;
        color: #006600;
        border-bottom: 2px solid #e0e0e0;
        padding-bottom: 10px;
        margin-top: 30px;
    }
    
    h3 {
        font-family: Verdana, Arial, sans-serif;
        font-size: 14pt;
        font-weight: bold;
        color: #006600;
        margin-top: 20px;
        margin-bottom: 10px;
    }
    
    a:link, a:visited {
        font-family: Verdana, Arial, sans-serif;
        font-weight: bold;
        color: #006600;
        text-decoration: none;
    }
    
    a:hover {
        color: #009900;
        text-decoration: underline;
    }
    
    .barranavegaciontop, .barranavegacionabajo {
        background-color: #f9f9f9;
        border: 1px solid #e0e0e0;
        border-radius: 5px;
        padding: 10px;
        margin: 20px 0;
        text-align: center;
    }
    
    .barranav {
        font-family: Verdana, Arial, sans-serif;
        font-weight: bold;
        color: #006600;
        text-decoration: none;
        margin: 0 10px;
    }
    
    .barranav:hover {
        color: #009900;
        text-decoration: underline;
    }
    
    .volver {
        text-align: right;
        margin: 20px 0;
    }
    
    ul {
        background-color: #f9f9f9;
        border: 1px solid #e0e0e0;
        border-radius: 5px;
        padding: 20px 40px;
        margin: 20px 0;
    }
    
    li {
        margin: 10px 0;
    }
    
    .ejemplo {
        background-color: #f0f0f0;
        border-left: 4px solid #006600;
        padding: 15px;
        margin: 15px 0;
        font-family: "Courier New", monospace;
        font-size: 12px;
        overflow-x: auto;
    }
    
    .nota {
        background-color: #fff8e1;
        border-left: 4px solid #ff9800;
        padding: 15px;
        margin: 15px 0;
    }
    
    .resultado {
        background-color: #e8f5e8;
        border-left: 4px solid #4caf50;
        padding: 15px;
        margin: 15px 0;
        font-family: "Courier New", monospace;
        font-size: 12px;
    }
    
    table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
    }
    
    img {
        border: 0;
        display: block;
        margin: 10px auto;
    }
    
    pre {
        margin: 0;
        white-space: pre-wrap;
    }
    
    code {
        color: #006600;
    }
    
    var {
        font-style: italic;
        color: #006600;
    }
    
    .letraC {
        font-weight: bold;
        color: #006600;
    }
    
    .texto {
        background-color: #f9f9f9;
        border: 1px solid #e0e0e0;
        border-radius: 5px;
        padding: 20px;
        margin: 20px 0;
    }
    
    .ejemplo pre {
        margin: 0;
        background: none;
        border: none;
        padding: 0;
    }
    
    b, strong {
        color: #006600;
    }
    
    u {
        color: #006600;
    }
    
    ol.texto {
        background-color: #f9f9f9;
        border: 1px solid #e0e0e0;
        border-radius: 5px;
        padding: 20px 40px;
        margin: 20px 0;
    }
    
    ol.texto li {
        margin: 10px 0;
    }
    
    table[border="1"] {
        width: 100%;
        border: 1px solid #e0e0e0;
        border-collapse: collapse;
        margin: 20px 0;
    }
    
    table[border="1"] td {
        border: 1px solid #e0e0e0;
        padding: 10px;
        text-align: center;
    }
    
    table[border="1"] th {
        border: 1px solid #e0e0e0;
        padding: 10px;
        background-color: #f9f9f9;
        font-weight: bold;
    }
    
    center {
        text-align: center;
    }
    
    font[color="#ff0000"] {
        color: #ff0000;
    }
    
    font[color="#0000ff"] {
        color: #0000ff;
    }
    
    blockquote.texto {
        background-color: #f9f9f9;
        border: 1px solid #e0e0e0;
        border-radius: 5px;
        padding: 20px;
        margin: 20px 0;
        font-style: italic;
    }
    
    em {
        font-style: italic;
    }
    
    .comprobado {
        font-size: 10px;
        color: #666;
        display: block;
        margin-top: 5px;
    }
    
    pre code {
        color: #006600;
    }
    
    .coment {
        color: #666;
        font-style: italic;
    }
    
    .enlace {
        text-decoration: none;
        color: #006600;
    }
    
    .enlace:hover {
        text-decoration: underline;
    }
    
    .mini {
        font-size: 10px;
        color: #666;
    }
-->
</style>
<!-- InstanceBeginEditable name="head" --><!-- InstanceEndEditable -->
</HEAD>
<BODY>
<a name="arriba"></a> 

<table width="100%" border="0">
<tr>
<td align="left"><img src="https://sic.cultura.gob.mx/imagenes_cache/universidad_4269_g_74422.png" alt="Curso de C" border="0" style="width: 300px; height: auto; max-width: 300px;">
</td>
<td align="right"><a href="http://www.elrincondelc.com" target="_top"><img src="logogrande.gif" alt="El Rincón del C - www.elrincondelc.com"  border="0"></a> 
</td>
</tr>
</table>
<!-- InstanceBeginEditable name="Titulo" -->
<h1>Asignación dinámica de memoria</h1>
<!-- InstanceEndEditable --> 

<p class="barranavegaciontop"><!-- InstanceBeginEditable name="BarraNavegacion" --> 
<a href="cursoc15.html" class="barranav">[Anterior]</a> <a href="cursoc17.html" class="barranav">[Siguiente]</a> 
<a href="index.html" target="_top" class="barranav">[Contenido]</a>
<!-- InstanceEndEditable --></p>

<!-- InstanceBeginEditable name="Cuerpo" -->
<a name="arriba"></a>

<A NAME="contenido"></A>
<H2>
	Contenido
</H2>

<UL>
	<LI><A HREF="#quees" class="enlace">¿Qué es la asignación dinámica?</A>
	<LI><A HREF="#malloc" class="enlace">Malloc y free</A>
	<LI><A HREF="#ejercicios" class="enlace">Ejercicios</A>
</UL>

<A NAME="quees"></A>
<H2>
	¿Qué es la asignación dinámica?
</H2>

<p>Hasta ahora hemos visto que cada vez que queremos usar una variable debemos reservarle un lugar de la memoria al comenzar el programa. Debemos indicar cuánta memoria vamos a usar. Pero hay ocasiones en que esto no es bueno, hay veces en las que no sabemos cuánta memoria vamos a necesitar. Por ejemplo si hacemos un editor de texto no podemos saber de antemano cuál va a ser la longitud del texto.</p>

<p>Por eso a veces es necesario poder reservar memoria según se va necesitando. Además de esta forma nuestros programas aprovecharán mejor la memoria del ordenador en el que se ejecuten, usando sólo lo necesario.</p>

<p>La asignación de memoria es la base de lo que veremos en capítulos posteriores, especialmente los capítulos de listas enlazadas. En éstos capítulos es donde se verá la verdadera utilidad de la asignación dinámica.</p>

<p class="volver"><a href="#arriba">[Arriba]</a></p>

<A NAME="malloc"></A>
<H2>
	Malloc y free
</H2>

<p>Existen varias funciones para la asignación dinámica de la memoria, pero las dos funciones básicas son <em>malloc</em> y <em>free</em>.</p>

<p>La función malloc (<B>M</B>emory <B>alloc</B>ate - asignar memoria) reservar una parte de la memoria y devuelve la dirección del comienzo de esa parte. Esta dirección podemos almacenarla en un puntero y así podemos acceder a la memoria reservada. La función malloc tiene el siguiente formato:</p>

<DIV CLASS="ejemplo"><PRE>
<var>puntero</var> = (<em>tipo_de_variable</em> *) <B>malloc(</B> <em>número de bytes a reservar</em> <B>);</B>
</PRE></DIV>

<ul class="texto">
<li><var>puntero</var>: es una variable tipo puntero que almacena la dirección del bloque de memoria reservado. Puede ser un puntero a char, int, float,...
<li>(<em>tipo_de_variable</em> *): es lo que se llama un <em>molde</em>. La función malloc nos reserva una cierta cantidad de bytes y devuelve un puntero del tipo <b>void</b> (que es uno genérico). Con el molde le indicamos al compilador que lo convierta en un puntero del mismo tipo que la variable <var>puntero</var>. Esto no es necesario en C, ya que lo hace automáticamente, aunque es aconsejable acostumbrarse a usarlo.
</ul>

<p>Una vez  reservada la memoria y guardada su dirección en un puntero podemos usar ese puntero como hemos visto hasta ahora.</p>

<p>Si no había suficiente memoria libre malloc devolverá el valor NULL. El puntero por tanto apuntará a NULL. Es muy importante comprobar siempre si se ha podido reservar memoria o no comprobando el valor de <var>puntero</var>:</p>

<DIV CLASS="ejemplo"><PRE>
if (puntero)
</PRE></DIV>

<p>se cumple si hay memoria suficiente, en caso contrario el falso.</p>

<p>Cuando ya no necesitemos más el espacio reservado debemos liberarlo, es decir, indicar al ordenador que puede destinarlo a otros fines. Si no liberamos el espacio que ya no necesitamos corremos el peligro de agotar la memoria del ordenador. Para ello usamos la función <em>free</em>, que funciona de la siguiente manera:</p>

<DIV CLASS="ejemplo"><PRE>
<B>free(</B> <em>puntero</em> <B>);</B>
</PRE></DIV>

<p>Donde <var>puntero</var> es un puntero que apunta al comienzo del bloque que habíamos reservado. Es muy importante no perder la dirección del comienzo del bloque, pues de otra forma no podremos liberarlo.</p>

<p>Vamos a ver un sencillo ejemplo del manejo de <code>malloc</code> y <code>free</code>:</p>

<DIV CLASS="ejemplo"><PRE>
#include &lt;stdio.h&gt;

int main()
    {
    int bytes;
    char *texto;

    printf("Cuantos bytes quieres reservar: ");
    scanf("%i",&bytes);
    texto = (char *) malloc(bytes);
    <font color="#0000ff">/* Comprobamos si ha tenido éxito la operación */</font>
    if (texto)
       {
       printf("Memoria reservada: %i bytes = %i kbytes = %i Mbytes\n",
              bytes, bytes/1024, bytes/(1024*1024));
       printf("El bloque comienza en la dirección: %p\n", texto);
       /* Ahora liberamos la memoria */
       free( texto );
       }
    else
        printf("No se ha podido reservar memoria\n");
    }
</PRE><DIV CLASS="comprobado">Comprobado con DJGPP</DIV></DIV>

<p>En este ejemplo se pregunta cuánta memoria se quiere reservar, si se consigue se indica cuánta memoria se ha reservado y dónde comienza el bloque. Si no se consigue se indica meniante el mensaje: "No se ha podido reservar memoria".</p>

<p>Probemos este ejemplo reservando 1000 bytes:</p>

<DIV CLASS="ejemplo"><PRE>
Cuantos bytes quieres reservar: <B>1000</B>
Memoria reservada: 1000 bytes = 0 kbytes = 0 Mbytes
El bloque comienza en la dirección: 90868
</PRE></DIV>

<p>Pruébalo unas cuantas veces incrementando el tamaño de la memoria que quieres reservar. Si tienes 32Mbytes de memoria RAM teclea lo siguiente:</p>

<DIV CLASS="ejemplo"><PRE>
Cuantos bytes quieres reservar: <B>32000000</B>
No se ha podido reservar memoria
</PRE></DIV>

<p>Malloc no ha podido reservar tanta memoria y devuelve (null) por lo que se nos avisa de que la operación no se ha podido realizar.</p>

<p class="volver"><a href="#arriba">[Arriba]</a></p>

<A NAME="ejercicios"></A>
<H2>
	Ejercicios
</H2>

<P><B><U>Ejercicio:</U></B>
</P>

<P><B>Solución:</B>
</P>

<p class="volver"><a href="#arriba">[Arriba]</a></p>

<!-- InstanceEndEditable --> 
<p class="barranavegacionabajo"><!-- InstanceBeginEditable name="PieNavegacion" --> 
<a href="cursoc15.html" class="barranav">[Anterior]</a> <a href="cursoc17.html" class="barranav">[Siguiente]</a> 
<a href="index.html" target="_top" class="barranav">[Contenido]</a>
<!-- InstanceEndEditable --></p>
</BODY>
</HTML>